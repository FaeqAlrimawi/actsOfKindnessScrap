{% extends 'base.html' %}

{% block title %}AoK Scrapper{% endblock  %}

{% block header  %}<link rel="stylesheet" type="text/css" href="{{url_for('static', filename='styles/scrapper.css')}}">{% endblock  %}

{% block  content %}


<br/>
<h3>Website Page</h3>

<form method="POST" id="scrapForm">

<input type="url" onblur="checkURL(this)" class="form-control" id="websiteURL" name="websiteURL" placeholder="Enter website URL" value="{{websiteURL}}"/>

<br/>

<button type="submit" class="btn btn-primary" >Scrap</button>

</form>

<br/>
<br/>

<div id="div-table">
  
    {% if  websiteURL %}
    <div class="collapsible" id="div-sitemap" >
      
        Scrapping: <a href="{{websiteURL}}" target="_blank"><b>{{websiteURL}}</b></a>
       
    </div>

    {% if sitemap['sitemap'] %}
    <div class="content" id="div-sitemap-content">
        <br/>
        <p style="font-size:120%;"> Potential URLs (click &#8631; to scrap)</p>
        {% for  sitemapURL in sitemap['sitemap'] %}
        {% set outer_loop = loop %}
            <ul >
                <li style="padding-bottom:1em"><a href="{{sitemapURL['url']}}" target="_blank">{{sitemapURL['url']}}</a></li>
                <ul>
                {% for potentialURL in sitemapURL['sites'] %}
                {% if  potentialURL['url'] != websiteURL %} 
                <li style="padding-bottom:1em"><a href="{{potentialURL['url']}}" target="_blank">{{potentialURL['url']}}</a>
                    <button type="button" class="close"  data-toggle="tooltip" title="Scrap" onClick="scrap('{{potentialURL['url']}}')">
                        {% if potentialURL['scrapped'] == False %}
                        <i class="fa-solid fa-splotch"></i>
                        {% endif %}
                        <i class="fa-regular fa-file-lines"></i>
                       
                       
                    </button>
                    
                </li>
                {% endif %}
                {% endfor %}
            </ul>
            </ul>
        {% endfor %}
       
    </div>

    {% else  %}
    <p class="content" id="div-sitemap=empty">
        Could not retrieve sitemaps. Check: <a href="{{robotsURL}}" target="_blank">{{robotsURL}}</a>
    </p>
    {% endif %}
<br/>

<!--
{% if canScrap == False %}
<div class="w3-panel w3-pale-yellow w3-border">
<h3>Warning</h3>
<p>Scraping may not be permissible on this webpage per the website's permissions. See: <a href="{{robotsURL}}" target="_blank">{{robotsURL}}</a><p>
   </div>
{% endif %}
-->

<br/><br/>

<table id="aoks" class="table table-striped">
    <thead >
        <tr>
        <th>#</th>
        <th>Description</th>
        <th>Prob (%)</th>
        <th>Add</th>
        </tr>
    </thead>
    <tbody> 
    
    {% for act_and_prob in acts_and_probs['data'] %}
    <tr>

        <th scope="row">{{ loop.index }}</th>
        <td id="td-{{loop.index}}" onClick="update_AoK({{loop.index}})">
            {{act_and_prob['text']}}
            
        </td>

  

        <td id="td-prob-{{loop.index}}">
            {{"{:.2f}".format(act_and_prob['prob_aok'])}}
        </td>
        
        <td >
            <button type="button" class="btn btn-outline-dark" id="btn-{{loop.index}}" onClick="add_AoK({{loop.index}}, '{{websiteURL}}')" data-toggle="tooltip" title="Add Act to AoK Database">
                <span aria-hidden="true" >&plus;</span>
            </button>
           <!-- <i class="fa fa-times-circle remove" style="font-size: 22px; color: red;"></i>-->

        </td>
    </tr>
    {% endfor %}
    
    </tbody>
    </table>

    {% endif %}
</div>
    
{% endblock  %}


{% block scripts %}

<script>
    var coll = document.getElementsByClassName("collapsible");
    var i;
    
    for (i = 0; i < coll.length; i++) {
      coll[i].addEventListener("click", function() {
        this.classList.toggle("active");
        var content = this.nextElementSibling;
        if (content.style.maxHeight){
          content.style.maxHeight = null;
        } else {
          content.style.maxHeight = content.scrollHeight + "px";
        } 
      });
    }
    </script>

<script>

  

    $(document).ready(function(){
        $('#aoks').DataTable({

        });
    });

</script>

{% endblock %}


