{% extends 'base.html' %}

{% block title %}AoK Scrapper{% endblock  %}

{% block  content %}

<br/>
<form method="POST">

<input type="url" class="form-control" id="websiteURL" name="websiteURL" placeholder="Enter website URL" value="{{websiteURL}}"/>

<br/>

<button type="submit" class="btn btn-primary">Scrap</button>

</form>

<br/>
<br/>

<div >
    {% if  websiteURL %}
    <h3>
      
        Scrapping: <a href="{{websiteURL}}" target="_blank">{{websiteURL}}</a>
       
    </h3>
    
<br/><br/>

<table id="aoks" class="table table-striped">
    <thead>
        <tr>
        <th>Description</th>
        <th>Prob (%)</th>
        <th>Add</th>
        </tr>
    </thead>
    <tbody> 
    
    {% for act_prob in act_probs %}
    <tr>
        <td id="td-{{loop.index}}" onClick="update_AoK('{{act_prob[0]}}', {{loop.index}})">
            {{act_prob[0]}}
            
        </td>

  

        <td>
            {{"{:.2f}".format(act_prob[1])}}
        </td>
        
        <td >
            <button type="button" class="btn btn-outline-dark" id="btn-{{loop.index}}" onClick="add_AoK('{{act_prob[0]}}', {{loop.index}})">
                <span aria-hidden="true" >&plus;</span>
            </button>

        </td>
    </tr>
    {% endfor %}
    
    </tbody>
    </table>
    {% endif %}
</div>
    
{% endblock  %}


{% block scripts %}

<script type="text/javascript">
    function add_AoK(act, row){
        fetch('/add-AoK', {
            method: 'POST',
            body: JSON.stringify({aok: act, row:row})
        }).then((response) => {
             $('#btn-'+row).find('span').html('&#10004;');
             $('#btn-'+row).attr('disabled', 'disabled');
            
        });
    }
</script>


<script type="text/javascript">
    function update_AoK(act, row){

        $('#td-'+row).html('<div align="left" style="width:100%;"> ' +
            '<textarea  name="act"  id="txtarea-"'+row+ '" style="width:100%; height:100%;">'+act+'</textarea>' +
            '<button type="button"  class="btn btn-secondary" onClick="updateAct(){'+
            $('#td-'+row) + '.html("'+act+'");' +
            '}">update</button>' +
            '</div>');
        
        $('#td-'+row).attr("onclick", "").unbind("click")
    }
</script>


<script>
    $(document).ready(function(){
        $('#aoks').DataTable({

        });
    });
</script>
{% endblock %}

